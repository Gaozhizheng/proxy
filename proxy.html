<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>加载中...</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html { width: 100%; height: 100%; overflow: hidden; font-family: -apple-system, sans-serif; background: #fff; }
    #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f8f9fa; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
    .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #333; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .loading-text { margin-top: 15px; color: #666; }
    iframe { width: 100%; height: 100vh; border: none; opacity: 0; transition: opacity 0.3s; position: absolute; top: 0; left: 0; }
    iframe.loaded { opacity: 1; }
    #error { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; justify-content: center; align-items: center; z-index: 10000; flex-direction: column; }
    #error button { margin-top: 20px; padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <div id="loading">
    <div class="spinner"></div>
    <div class="loading-text">页面加载中...</div>
  </div>
  <div id="error">
    <p>加载失败</p>
    <button onclick="retry()">重试</button>
  </div>
  <iframe id="frame" src="about:blank"></iframe>

  <script>
    // 从 URL Hash 获取目标（如 #aHR0cHM6Ly9iYWlkdS5jb20=）
    const hash = window.location.hash.slice(1); // 去掉 #
    const frame = document.getElementById('frame');
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');

    if (!hash) {
      showError('缺少目标链接');
      exit;
    }

    let target;
    try {
      target = atob(hash); // Base64 解码
      new URL(target); // 验证是否为合法 URL
    } catch (e) {
      showError('链接无效或已过期');
      exit;
    }

    frame.src = target;

    frame.onload = () => {
      loading.style.opacity = 0;
      setTimeout(() => loading.style.display = 'none', 500);
      frame.classList.add('loaded');
    };

    frame.onerror = () => showError('加载出错');

    setTimeout(() => {
      if (!frame.classList.contains('loaded')) {
        showError('加载超时');
      }
    }, 10000);

    function showError(msg) {
      loading.style.display = 'none';
      error.style.display = 'flex';
      error.querySelector('p').textContent = msg;
    }

    function retry() {
      frame.src = frame.src;
      error.style.display = 'none';
      loading.style.display = 'flex';
    }
  </script>
</body>
</html>
